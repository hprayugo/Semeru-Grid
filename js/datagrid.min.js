(function(e){e.fn.datagrid=function(t){function l(){e(u).append("<thead><tr></tr></thead><tbody></tbody>");n.rowNumber==true||n.rowNumber=="true"?e(u).children("thead").children().append("<th style='text-align: center; width: 20px;'>No</th>"):"";n.rowCheck==true||n.rowCheck=="true"?e(u).children("thead").children().append("<th style='text-align: center; width: 20px;'><input type='checkbox'></th>"):"";n.columns.forEach(function(t){e(u).children("thead").children().append("<th title='"+t.field+"' style='text-align: "+t.align+"; width: "+t.width+"px;'>"+t.title+"</th>")})}function c(t,l,d){var t=parseInt(t);var v=t*l-l;e.ajax({url:n.url,async:false,type:"post",dataType:"json",data:{limit:v,offset:l,sort:i,order:o,searchData:d},success:function(m){r=e.map(m,function(e){return e});e(u).children("tbody").each(function(){var t=e(this);var i=v+1;var s="";for(var o=1;o<r.length;o++){s+="<tr>";s+=n.rowNumber==true||n.rowNumber=="true"?"<td id='no'>"+i+"</td>":"";s+=n.rowCheck==true||n.rowCheck=="true"?"<td style='text-align: center; width: 20px;'><input value='"+r[o][n.primaryField]+"' type='checkbox'></td>":"";n.columns.forEach(function(e,t){if(r[o][e.field]!=undefined){s+="<td style='text-align: "+e.align+"; width: "+e.width+"px;'>"+r[o][e.field]+"</td>"}else{s+="<td style='text-align: "+e.align+"; width: "+e.width+"px;'>"+e.rowStyler(r[o],o)+"</td>"}});s+="</tr>";i++}e(t).children().remove();e(t).append(s)});e(u).children("thead").children().each(function(){e(this).children().each(function(t,u){if(t==h()){e(this).children().on("click",function(){if(e(this).prop("checked")){e.ajax({url:n.url,async:false,type:"post",dataType:"json",data:{limit:0,offset:r[0],sort:i,order:o,searchData:d},success:function(t){s=[];arrCheckData=e.map(t,function(e){return e});for(var r=0;r<arrCheckData.length;r++){s[s.length]=arrCheckData[r][n.primaryField]}c(n.currentPage,n.currentPageSize,p())}})}else{s=[];c(n.currentPage,n.currentPageSize,p())}})}})});e(u).children("tbody").children().each(function(){e(this).children().each(function(t,r){if(t==h()){e(this).children().each(function(){for(var t=0;t<s.length;t++){if(s[t]==this.value){e(this).prop("checked",true)}}e(this).on("click",function(){var e,t=false;for(var r=0;r<s.length;r++){if(s[r]==this.value){t=true;e=r}}if(!t){s[s.length]=this.value}else{s.splice(e,1)}c(n.currentPage,n.currentPageSize,p())})})}})});var g="";for(var y=0;y<n.pageSize.length;y++){g+="<option value='"+n.pageSize[y]+"'>"+n.pageSize[y]+"</option>"}e(option).html(g);e(option).val(n.currentPageSize);e(option).on("change",function(){var t=e(option).children("option:selected").val();if(t!=""){n.currentPageSize=t;c(1,n.currentPageSize,p())}});var b=t*l-l+1;var w=t==Math.ceil(r[0]/l)?t*l-1:t*l;e(a).html("showing "+b+"-"+w+" of "+r[0]+" items");var E="";E+='<li title="first">First</li>';E+='<li title="prev">Prev</li>';if(t==Math.ceil(r[0]/l)&&t-2>=1){E+='<li title="'+(t-2)+'">'+(t-2)+"</li>"}if(t-1>=1){E+='<li title="'+(t-1)+'">'+(t-1)+"</li>"}E+='<li id="active" title="'+t+'">'+t+"</li>";if(t+1<=Math.ceil(r[0]/l)){E+='<li title="'+(t+1)+'">'+(t+1)+"</li>"}if(t==1&&t+2<=Math.ceil(r[0]/l)){E+='<li title="'+(t+2)+'">'+(t+2)+"</li>"}E+='<li title="next">Next</li>';E+='<li title="last">Last</li>';e(f).html(E);e(f).children("li").each(function(){e(this).on("click",function(){if(this.title=="prev"&&t-1>=1){c(t-1,n.currentPageSize,p());n.currentPage--}else if(this.title=="next"&&t+1<=Math.ceil(r[0]/l)){c(t+1,n.currentPageSize,p());n.currentPage++}else if(this.title=="first"){c(1,n.currentPageSize,p());n.currentPage=1}else if(this.title=="last"){c(Math.ceil(r[0]/l),n.currentPageSize,p());n.currentPage=Math.ceil(r[0]/l)}else if(parseInt(this.title)<=t+2||parseInt(this.title)>=t-2){c(this.title,n.currentPageSize,p());n.currentPage=this.title}})})}})}function h(){var e=-1;n.rowNumber==true||n.rowNumber=="true"?e+=1:"";n.rowCheck==true||n.rowCheck=="true"?e+=1:"";return e}function p(){var t=e(n.searchOption).val();var r=e(n.search).val();if(r==""){var i=""}else{var i=[{field:t,searchText:r}]}return i}function d(){n.columns.forEach(function(t){if(t.search==true){e(n.searchOption).append('<option value="'+t.field+'">'+t.title+"</option>")}});e(n.search).on("keyup",function(){c(1,n.currentPageSize,p())});e(n.searchOption).on("change",function(){c(1,n.currentPageSize,p())})}var n=e.extend({url:"",primaryField:"",rowNumber:false,rowCheck:false,paging:"",info:"",option:"",search:"",searchOption:"",currentPage:1,currentPageSize:10,pageSize:[10,20,50,100],columns:[]},t);var r=[];var i="";var s=[];var o="DESC";var u=e(this);var a=e(n.info);var f=e(n.paging);this.sortData=function(){e(u).children("thead").children().children().each(function(t,r){if(t>h()){e(this).on("click",function(){i=this.title;if(o=="DESC"){o="ASC"}else{o="DESC"}c(n.currentPage,n.currentPageSize,p())})}})};this.reload=function(){c(n.currentPage,n.currentPageSize,p())};this.getChecked=function(){return s.toString()};this.setChecked=function(e){for(var t=0;t<e.length;t++){var r=false;for(var i=0;i<s.length;i++){if(s[i]==e[t]){r=true}}if(!r){s[s.length]=e[t]}}c(n.currentPage,n.currentPageSize,p())};this.getData=function(e){c(n.currentPage,n.currentPageSize,p());return r[e]};l();c(n.currentPage,n.currentPageSize,p());this.sortData();d();return this}})(jQuery)